# 学生管理系统 — 变更记录

## 一、文档说明

本文档用于记录学生管理系统在开发与维护过程中的所有重要变更，包括需求变更、功能更新、Bug 修复、技术调整等，为项目管理与版本追溯提供依据。

---

## 二、变更记录规范

### 2.1 版本号规范

采用语义化版本号（Semantic Versioning）：`主版本号.次版本号.修订号`

- **主版本号：** 不兼容的 API 修改
- **次版本号：** 向下兼容的功能性新增
- **修订号：** 向下兼容的问题修正

### 2.2 变更类型

| 类型 | 说明 |
| ---- | ---- |
| 新增（Added） | 新增功能 |
| 变更（Changed） | 功能变更 |
| 废弃（Deprecated） | 即将废弃的功能 |
| 移除（Removed） | 已移除的功能 |
| 修复（Fixed） | Bug 修复 |
| 安全（Security） | 安全相关修复 |

### 2.3 记录格式

```
## [版本号] - 发布日期

### 变更类型

- 变更描述 (#Issue编号)
```

---

## 三、变更记录

### [未发布]

#### 新增（Added）

- 项目初始化
- 创建项目需求说明文档
- 创建技术选型说明文档
- 创建权限与角色说明文档
- 创建开发计划文档
- 创建接口说明文档
- 创建数据库设计文档
- 创建部署说明文档
- 创建变更记录文档

---

### [1.2.1] - 2026-01-02

#### 新增（Added）

- **独立测试数据库支持**
  - 新增 `.env.test` 测试环境配置文件
  - 新增 `scripts/init-test-db.js` 测试数据库初始化脚本
  - 新增 npm 脚本：`init-test-db`、`init-test-db:reset`、`init-test-db:clean`
  - 集成测试自动使用独立测试数据库 `student_management_test`

#### 变更（Changed）

- **测试配置优化**
  - `__tests__/setup.js` 修改为加载 `.env.test` 配置
  - 集成测试运行前自动重置测试数据库（`pretest:integration`）

- **文档更新**
  - 更新 README.md，添加测试数据库配置说明
  - 更新测试报告文档，添加独立测试数据库使用说明
  - 更新权限与角色说明文档，将"超级管理员"统一改为"管理员"

---

### [1.2.0] - 2026-01-01

#### 新增（Added）

- **审批功能**
  - 辅导员审批学生加入专业班级（通过/拒绝）
  - 教师审批学生加入课程班级（通过/拒绝）
  - 批量审批功能
  - 前端审批按钮和操作界面

- **辅导员专属接口**
  - `GET /api/v1/counselor/my-major-classes` 获取负责的班级列表
  - `GET /api/v1/counselor/my-major-classes/:id` 获取班级详情
  - `GET /api/v1/counselor/my-major-classes/:id/students` 获取班级学生
  - `PUT /api/v1/counselor/my-major-classes/:id/students/:studentId/approve` 审批通过
  - `PUT /api/v1/counselor/my-major-classes/:id/students/:studentId/reject` 审批拒绝
  - `POST /api/v1/counselor/my-major-classes/:id/students/batch-approve` 批量审批
  - `GET /api/v1/counselor/my-students` 获取所有学生
  - `POST /api/v1/counselor/create-student` 创建学生账号
  - `POST /api/v1/counselor/batch-create-students` 批量创建学生

- **搜索功能增强**
  - 课程班级支持按教师姓名搜索
  - 专业班级支持按辅导员姓名搜索

- **运行说明文档**
  - 新增 `docs/学生管理系统_运行说明.md`

#### 变更（Changed）

- **状态字段简化**
  - 关联表 status 从 4 个值（pending/approved/rejected/removed）简化为 2 个值（pending/approved）
  - 拒绝申请时直接删除记录
  - 移除学生时直接删除记录

- **用户表结构**
  - 新增 `employee_id` 字段（教师/辅导员工号）
  - 新增 `student_id` 字段（学生学号）

- **用户状态简化**
  - 移除 `locked` 状态，只保留 `active` 和 `inactive`

- **文档更新**
  - 更新数据库设计文档，反映实际表结构
  - 更新接口说明文档，新增辅导员接口和审批接口
  - 更新权限与角色说明文档，新增审批功能说明

#### 修复（Fixed）

- 修复用户管理页面编辑功能（分离创建和编辑的表单验证规则）
- 修复空邮箱验证问题（空字符串不发送）
- 修复 SQL 语法错误（LIMIT 和 OFFSET 参数直接嵌入 SQL 字符串）

---

### [1.1.0] - 2025-12-30

#### 新增（Added）

- **批量操作接口**
  - 新增 `POST /api/v1/users/batch` 批量创建用户接口
  - 新增 `POST /api/v1/users/batch-get` 批量获取用户详情接口
  - 新增 `DELETE /api/v1/users/batch` 批量删除用户接口
  - 新增 `DELETE /api/v1/major-classes/batch` 批量删除专业班级接口
  - 新增 `POST /api/v1/major-classes/:id/students/batch` 批量添加学生到专业班级接口
  - 新增 `DELETE /api/v1/major-classes/:id/students/batch` 批量移除学生从专业班级接口
  - 新增 `DELETE /api/v1/course-classes/batch` 批量删除课程班级接口
  - 新增 `POST /api/v1/course-classes/:id/students/batch` 批量添加学生到课程班级接口
  - 新增 `DELETE /api/v1/course-classes/:id/students/batch` 批量移除学生从课程班级接口

- **数据库关联表状态字段**
  - `student_major_class` 表新增 `status` 字段
  - `student_major_class` 表新增 `approved_at` 审核时间字段
  - `student_major_class` 表新增 `approved_by` 审核人字段
  - `student_major_class` 表新增 `remark` 备注字段
  - `student_course_class` 表新增相同字段

- **前端批量操作支持**
  - 新增 `useBatchOperation` 组合式函数
  - 新增批量操作 API 封装
  - 新增错误码常量映射

#### 变更（Changed）

- **接口说明文档升级**
  - 所有接口增加错误码响应示例
  - 新增业务错误码速查表
  - 新增批量接口汇总表
  - 统一批量接口响应格式规范

- **前端设计说明文档完善**
  - 完善目录结构规范，增加 composables、constants 目录
  - 新增批量操作设计方案
  - 新增错误码处理机制
  - 新增性能优化建议
  - 新增改进建议汇总

- **数据库设计文档更新**
  - 更新关联表结构，增加审核相关字段
  - 新增数据库迁移脚本
  - 更新 E-R 关系图
  - 新增关联表状态说明

---

### [1.0.0] - 待定

#### 新增（Added）

- 用户认证模块
  - 用户登录功能
  - 用户注册功能
  - 忘记密码功能
  - 密码重置功能
  - 修改密码功能
  - 记住我功能

- 用户管理模块
  - 用户列表查询
  - 用户信息创建
  - 用户信息修改
  - 用户信息删除
  - 用户状态管理

- 专业班级管理模块
  - 专业班级列表查询
  - 专业班级创建
  - 专业班级修改
  - 专业班级删除
  - 专业班级学生管理
  - 学生加入/退出专业班级

- 课程班级管理模块
  - 课程班级列表查询
  - 课程班级创建
  - 课程班级修改
  - 课程班级删除
  - 课程班级学生管理
  - 学生加入/退出课程班级

- 权限控制
  - 基于角色的访问控制（RBAC）
  - 接口权限校验
  - 数据范围权限控制

- 前端页面
  - 登录/注册页面
  - 学生端页面
  - 教师端页面
  - 辅导员端页面
  - 管理员端页面

---

## 四、需求变更记录

### 变更编号：CR-001

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2025-12-30 |
| 变更类型 | 需求新增 |
| 变更描述 | 增加批量操作接口，支持数组 ID 参数 |
| 影响范围 | 接口说明文档、前端设计说明文档 |
| 变更原因 | 减轻前端请求压力，提升批量操作效率 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 涉及用户、专业班级、课程班级三个模块 |

---

### 变更编号：CR-002

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2025-12-30 |
| 变更类型 | 需求新增 |
| 变更描述 | 数据库关联表增加 status 字段，预留审核机制 |
| 影响范围 | 数据库设计文档、接口说明文档 |
| 变更原因 | 为未来可能的审核机制预留扩展空间 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 当前默认值为 approved，审核功能暂不实现 |

---

### 变更编号：CR-003

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2025-12-30 |
| 变更类型 | 文档优化 |
| 变更描述 | 接口说明文档升级为"接口 + 错误码示例"格式 |
| 影响范围 | 接口说明文档 |
| 变更原因 | 提升接口文档可读性，便于前端开发对接 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 所有接口均增加成功和失败响应示例 |

---

### 变更编号：CR-004

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2026-01-01 |
| 变更类型 | 需求实现 |
| 变更描述 | 实现审批功能，辅导员/教师可审批学生加入班级 |
| 影响范围 | 后端控制器、路由、前端页面 |
| 变更原因 | 完善业务流程，学生申请需要审批 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 简化状态为 pending/approved，拒绝直接删除记录 |

---

### 变更编号：CR-005

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2026-01-01 |
| 变更类型 | 功能增强 |
| 变更描述 | 搜索功能支持按教师/辅导员姓名搜索班级 |
| 影响范围 | 后端模型、前端页面 |
| 变更原因 | 提升搜索体验，方便查找特定教师/辅导员的班级 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 课程班级支持教师姓名，专业班级支持辅导员姓名 |

---

### 变更编号：CR-006

| 项目 | 内容 |
| ---- | ---- |
| 变更日期 | 2026-01-02 |
| 变更类型 | 测试优化 |
| 变更描述 | 配置独立测试数据库，测试与开发环境隔离 |
| 影响范围 | 测试配置、npm 脚本 |
| 变更原因 | 避免测试数据污染开发数据库 |
| 处理状态 | 已完成 |
| 处理人 | - |
| 备注 | 测试数据库名称为 student_management_test |

---

## 五、Bug 修复记录

### Bug 编号：BUG-001

| 项目 | 内容 |
| ---- | ---- |
| 发现日期 | 2026-01-01 |
| 严重程度 | 中 |
| Bug 描述 | 用户管理页面编辑用户时，密码字段验证失败 |
| 复现步骤 | 1. 打开用户管理页面 2. 点击编辑用户 3. 不修改密码直接保存 |
| 影响范围 | 用户管理功能 |
| 修复方案 | 分离创建和编辑的表单验证规则，编辑时密码为可选 |
| 修复日期 | 2026-01-01 |
| 修复人 | - |
| 验证状态 | 已验证 |
| 备注 | - |

---

### Bug 编号：BUG-002

| 项目 | 内容 |
| ---- | ---- |
| 发现日期 | 2026-01-01 |
| 严重程度 | 低 |
| Bug 描述 | 编辑用户时，空邮箱字段发送空字符串导致验证失败 |
| 复现步骤 | 1. 编辑用户 2. 清空邮箱字段 3. 保存 |
| 影响范围 | 用户管理功能 |
| 修复方案 | 当邮箱为空字符串时不发送该字段 |
| 修复日期 | 2026-01-01 |
| 修复人 | - |
| 验证状态 | 已验证 |
| 备注 | - |

---

### Bug 编号：BUG-003

| 项目 | 内容 |
| ---- | ---- |
| 发现日期 | 2026-01-01 |
| 严重程度 | 高 |
| Bug 描述 | SQL 查询中 LIMIT 和 OFFSET 参数使用占位符导致语法错误 |
| 复现步骤 | 1. 访问分页接口 2. 查看后端错误日志 |
| 影响范围 | 所有分页查询接口 |
| 修复方案 | LIMIT 和 OFFSET 参数直接嵌入 SQL 字符串 |
| 修复日期 | 2026-01-01 |
| 修复人 | - |
| 验证状态 | 已验证 |
| 备注 | MySQL 驱动对 LIMIT 占位符支持有问题 |

---

## 六、技术调整记录

### 调整编号：TA-001

| 项目 | 内容 |
| ---- | ---- |
| 调整日期 | 2025-12-30 |
| 调整类型 | 架构优化 |
| 调整描述 | 前端新增 composables 目录，引入组合式函数设计模式 |
| 调整原因 | 提升代码复用性，统一批量操作逻辑 |
| 影响范围 | 前端项目结构 |
| 执行人 | - |
| 备注 | 新增 useBatchOperation 等组合式函数 |

---

### 调整编号：TA-002

| 项目 | 内容 |
| ---- | ---- |
| 调整日期 | 2025-12-30 |
| 调整类型 | 数据库设计 |
| 调整描述 | 关联表增加审核相关字段 |
| 调整原因 | 预留审核机制扩展空间 |
| 影响范围 | student_major_class、student_course_class 表 |
| 执行人 | - |
| 备注 | 提供数据库迁移脚本 |

---

### 调整编号：TA-003

| 项目 | 内容 |
| ---- | ---- |
| 调整日期 | 2026-01-01 |
| 调整类型 | 数据库设计 |
| 调整描述 | 简化关联表状态字段，从 4 个值减少为 2 个值 |
| 调整原因 | 简化业务逻辑，拒绝和移除操作直接删除记录 |
| 影响范围 | student_major_class、student_course_class 表 |
| 执行人 | - |
| 备注 | 状态只保留 pending 和 approved |

---

### 调整编号：TA-004

| 项目 | 内容 |
| ---- | ---- |
| 调整日期 | 2026-01-02 |
| 调整类型 | 测试架构 |
| 调整描述 | 配置独立测试数据库，测试环境与开发环境隔离 |
| 调整原因 | 避免测试数据污染开发数据库，提升测试可靠性 |
| 影响范围 | 测试配置文件、npm 脚本 |
| 执行人 | - |
| 备注 | 新增 .env.test 和 init-test-db.js |

---

## 七、发布记录

### 发布编号：REL-001

| 项目 | 内容 |
| ---- | ---- |
| 发布版本 | v1.0.0 |
| 发布日期 | 待定 |
| 发布环境 | 生产环境 |
| 发布内容 | 首次发布，包含全部基础功能 |
| 发布人 | - |
| 回滚方案 | 数据库备份 + 代码版本回退 |
| 备注 | - |

---

### 发布编号：REL-002

| 项目 | 内容 |
| ---- | ---- |
| 发布版本 | v1.1.0 |
| 发布日期 | 2025-12-30 |
| 发布环境 | 生产环境 |
| 发布内容 | 批量操作接口、审核机制预留、文档优化 |
| 发布人 | - |
| 回滚方案 | 数据库备份 + 代码版本回退 + 数据库回滚脚本 |
| 备注 | 需执行数据库迁移脚本 |

---

### 发布编号：REL-003

| 项目 | 内容 |
| ---- | ---- |
| 发布版本 | v1.2.0 |
| 发布日期 | 2026-01-01 |
| 发布环境 | 生产环境 |
| 发布内容 | 审批功能、辅导员接口、搜索增强、Bug修复 |
| 发布人 | - |
| 回滚方案 | 数据库备份 + 代码版本回退 |
| 备注 | 状态字段简化，需重新初始化数据库 |

---

### 发布编号：REL-004

| 项目 | 内容 |
| ---- | ---- |
| 发布版本 | v1.2.1 |
| 发布日期 | 2026-01-02 |
| 发布环境 | 开发/测试环境 |
| 发布内容 | 独立测试数据库支持、文档术语统一 |
| 发布人 | - |
| 回滚方案 | 代码版本回退 |
| 备注 | 测试环境优化，不影响生产环境 |

---

## 八、文档变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
| ---- | ---- | -------- | ------ |
| 2025-XX-XX | v1.0 | 创建变更记录文档 | - |
| 2025-12-30 | v1.1 | 记录批量接口、审核机制预留、文档优化等变更 | - |
| 2026-01-01 | v1.2 | 记录审批功能、辅导员接口、搜索增强、Bug修复等变更 | - |
| 2026-01-02 | v1.3 | 记录独立测试数据库配置、文档术语统一等变更 | - |

---

## 九、附录

### 9.1 变更审批流程

1. 提交变更申请
2. 评估变更影响
3. 审批变更请求
4. 执行变更
5. 验证变更结果
6. 更新变更记录

### 9.2 紧急变更处理

对于紧急 Bug 修复或安全漏洞修复：

1. 立即评估影响范围
2. 快速制定修复方案
3. 执行修复并测试
4. 紧急发布
5. 事后补充变更记录

### 9.3 版本回退流程

1. 确认回退版本
2. 备份当前数据
3. 执行代码回退
4. 执行数据库回退（如需要）
5. 验证系统功能
6. 记录回退原因

---

## 十、总结

本变更记录文档将持续更新，记录项目开发与维护过程中的所有重要变更。所有团队成员在进行重要变更时，应及时更新本文档，确保项目变更可追溯、可管理。

**v1.2.1 版本变更摘要：**
- 配置独立测试数据库（student_management_test）
- 新增测试数据库初始化脚本
- 集成测试自动重置测试数据库
- 文档术语统一（"超级管理员"改为"管理员"）