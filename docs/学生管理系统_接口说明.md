# 学生管理系统 — 接口说明

## 一、文档说明

本文档用于说明学生管理系统后端 API 接口的设计规范与详细定义，包含错误码示例，为前后端开发提供统一的接口约定。

---

## 二、接口规范

### 2.1 基础信息

- **基础路径：** `/api/v1`
- **请求格式：** JSON
- **响应格式：** JSON
- **字符编码：** UTF-8

### 2.2 请求头规范

| 请求头 | 说明 | 是否必须 |
| ------ | ---- | -------- |
| Content-Type | application/json | 是 |
| Authorization | Bearer {token} | 需要认证的接口必须 |

### 2.3 响应格式规范

**成功响应：**

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

**失败响应：**

```json
{
  "code": 10001,
  "message": "用户名已存在",
  "data": null
}
```

### 2.4 HTTP 状态码与业务错误码对照

| HTTP 状态码 | 业务错误码范围 | 说明 |
| ----------- | -------------- | ---- |
| 200 | 200 | 请求成功 |
| 400 | 90001 | 参数校验失败 |
| 401 | 40002 | 未授权/Token 失效 |
| 403 | 40001, 40003, 40004 | 权限不足 |
| 404 | 10002, 20002 | 资源不存在 |
| 500 | 90002, 90003 | 服务器错误 |

### 2.5 业务错误码速查表

| 错误码 | 含义 | 适用场景 |
| ------ | ---- | -------- |
| 10001 | 用户名已存在 | 注册、创建用户 |
| 10002 | 用户不存在 | 登录、查询用户 |
| 10003 | 密码错误 | 登录 |
| 10004 | 账号已被禁用 | 登录 |
| 10005 | 原密码错误 | 修改密码 |
| 10006 | 新密码不符合规则 | 修改密码 |
| 10007 | 验证码错误或已过期 | 重置密码 |
| 20001 | 班级人数已满 | 加入班级 |
| 20002 | 班级不存在 | 班级操作 |
| 20003 | 班级已被删除 | 班级操作 |
| 20004 | 班级名称已存在 | 创建班级 |
| 30001 | 学生已在该班级中 | 加入班级 |
| 30002 | 学生不在该班级中 | 退出班级 |
| 30003 | 学生未分配专业班级 | 班级查询 |
| 30004 | 学生不属于当前操作范围 | 权限校验 |
| 40001 | 无权限执行该操作 | 权限校验 |
| 40002 | 登录状态已失效 | Token 过期 |
| 40003 | 角色不匹配 | 权限校验 |
| 90001 | 参数校验失败 | 参数验证 |
| 90002 | 系统内部错误 | 服务异常 |

---

## 三、认证模块接口

### 3.1 用户登录

**接口路径：** `POST /api/v1/auth/login`

**请求示例：**
```json
{ "username": "student001", "password": "123456", "rememberMe": true }
```

**成功响应：**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "userInfo": { "id": 1, "username": "student001", "realName": "张三", "role": "student" }
  }
}
```

**错误响应示例：**
```json
{ "code": 10002, "message": "用户不存在", "data": null }
{ "code": 10003, "message": "密码错误", "data": null }
{ "code": 10004, "message": "账号已被禁用", "data": null }
```

---

### 3.2 用户注册

**接口路径：** `POST /api/v1/auth/register`

**请求参数：** username, password, confirmPassword, realName, email(可选), phone(可选)

**成功响应：**
```json
{ "code": 200, "message": "注册成功", "data": { "id": 1, "username": "student001" } }
```

**错误响应示例：**
```json
{ "code": 10001, "message": "用户名已存在", "data": null }
{ "code": 90001, "message": "参数校验失败", "data": { "errors": [{ "field": "password", "message": "密码长度不能少于6位" }] } }
```

---

### 3.3 忘记密码 / 重置密码 / 修改密码

**忘记密码：** `POST /api/v1/auth/forgot-password`
**重置密码：** `POST /api/v1/auth/reset-password`
**修改密码：** `PUT /api/v1/auth/change-password`

**常见错误响应：**
```json
{ "code": 10007, "message": "验证码错误或已过期", "data": null }
{ "code": 10005, "message": "原密码错误", "data": null }
{ "code": 10006, "message": "新密码不符合规则", "data": null }
```

---

### 3.4 获取当前用户信息

**接口路径：** `GET /api/v1/auth/current-user`

**成功响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": { "id": 1, "username": "student001", "realName": "张三", "role": "student", "email": "zhangsan@example.com" }
}
```

**错误响应：**
```json
{ "code": 40002, "message": "登录状态已失效，请重新登录", "data": null }
```

---

## 四、用户管理接口

### 4.1 获取用户列表

**接口路径：** `GET /api/v1/users`
**权限：** 超级管理员
**参数：** page, pageSize, role, keyword

---

### 4.2 创建用户

**接口路径：** `POST /api/v1/users`
**权限：** 超级管理员、辅导员（仅学生）

**错误响应示例：**
```json
{ "code": 10001, "message": "用户名已存在", "data": null }
{ "code": 40003, "message": "角色不匹配，辅导员仅能创建学生账号", "data": null }
```

---

### 4.3 批量创建用户 ⭐

**接口路径：** `POST /api/v1/users/batch`
**权限：** 超级管理员、辅导员（仅学生）
**限制：** 最多 100 条

**请求示例：**
```json
{
  "users": [
    { "username": "student001", "password": "123456", "realName": "张三", "role": "student" },
    { "username": "student002", "password": "123456", "realName": "李四", "role": "student" }
  ]
}
```

**成功响应：**
```json
{
  "code": 200,
  "message": "批量创建完成",
  "data": {
    "success": 2,
    "failed": 0,
    "results": [
      { "username": "student001", "id": 10, "status": "success" },
      { "username": "student002", "id": 11, "status": "success" }
    ]
  }
}
```

**部分失败响应：**
```json
{
  "code": 200,
  "message": "批量创建部分完成",
  "data": {
    "success": 1,
    "failed": 1,
    "results": [
      { "username": "student001", "id": 10, "status": "success" },
      { "username": "student002", "status": "failed", "error": { "code": 10001, "message": "用户名已存在" } }
    ]
  }
}
```

---

### 4.4 批量获取用户详情 ⭐

**接口路径：** `POST /api/v1/users/batch-get`
**权限：** 超级管理员、辅导员
**限制：** 最多 100 个 ID

**请求示例：**
```json
{ "ids": [1, 2, 3, 4, 5] }
```

**响应示例：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      { "id": 1, "username": "student001", "realName": "张三", "role": "student", "status": "active" },
      { "id": 2, "username": "student002", "realName": "李四", "role": "student", "status": "active" }
    ],
    "notFound": [3, 4, 5]
  }
}
```

---

### 4.5 批量删除用户 ⭐

**接口路径：** `DELETE /api/v1/users/batch`
**权限：** 超级管理员
**限制：** 最多 100 个 ID

**请求示例：**
```json
{ "ids": [10, 11, 12] }
```

**响应示例：**
```json
{
  "code": 200,
  "message": "批量删除完成",
  "data": { "success": 2, "failed": 1, "failedIds": [12], "failedReasons": [{ "id": 12, "code": 10002, "message": "用户不存在" }] }
}
```

---

### 4.6 其他用户接口

| 接口 | 方法 | 路径 | 说明 |
| ---- | ---- | ---- | ---- |
| 获取用户详情 | GET | /api/v1/users/:id | 单个用户详情 |
| 更新用户信息 | PUT | /api/v1/users/:id | 更新用户 |
| 删除用户 | DELETE | /api/v1/users/:id | 删除单个用户 |

---

## 五、专业班级管理接口

### 5.1 基础 CRUD 接口

| 接口 | 方法 | 路径 | 权限 |
| ---- | ---- | ---- | ---- |
| 获取列表 | GET | /api/v1/major-classes | 所有登录用户 |
| 创建班级 | POST | /api/v1/major-classes | 超级管理员 |
| 获取详情 | GET | /api/v1/major-classes/:id | 所有登录用户 |
| 更新班级 | PUT | /api/v1/major-classes/:id | 超级管理员、辅导员 |
| 删除班级 | DELETE | /api/v1/major-classes/:id | 超级管理员 |

---

### 5.2 批量删除专业班级 ⭐

**接口路径：** `DELETE /api/v1/major-classes/batch`
**权限：** 超级管理员
**限制：** 最多 50 个 ID

**请求示例：**
```json
{ "ids": [1, 2, 3] }
```

---

### 5.3 学生与专业班级关系接口

| 接口 | 方法 | 路径 | 说明 |
| ---- | ---- | ---- | ---- |
| 获取学生列表 | GET | /api/v1/major-classes/:id/students | 支持 status 筛选 |
| 添加学生 | POST | /api/v1/major-classes/:id/students | 单个添加 |
| 移除学生 | DELETE | /api/v1/major-classes/:id/students/:studentId | 单个移除 |

---

### 5.4 批量添加学生到专业班级 ⭐

**接口路径：** `POST /api/v1/major-classes/:id/students/batch`
**权限：** 超级管理员、辅导员
**限制：** 最多 100 个学生 ID

**请求示例：**
```json
{ "studentIds": [1, 2, 3, 4, 5] }
```

**响应示例：**
```json
{
  "code": 200,
  "message": "批量添加完成",
  "data": {
    "success": 4,
    "failed": 1,
    "results": [
      { "studentId": 1, "status": "success" },
      { "studentId": 2, "status": "success" },
      { "studentId": 3, "status": "failed", "error": { "code": 30001, "message": "学生已在该班级中" } }
    ]
  }
}
```

---

### 5.5 批量移除学生从专业班级 ⭐

**接口路径：** `DELETE /api/v1/major-classes/:id/students/batch`
**权限：** 超级管理员、辅导员
**限制：** 最多 100 个学生 ID

**请求示例：**
```json
{ "studentIds": [1, 2, 3] }
```

**响应示例：**
```json
{
  "code": 200,
  "message": "批量移除完成",
  "data": {
    "success": 2,
    "failed": 1,
    "results": [
      { "studentId": 1, "status": "success" },
      { "studentId": 2, "status": "success" },
      { "studentId": 3, "status": "failed", "error": { "code": 30002, "message": "学生不在该班级中" } }
    ]
  }
}
```

---

## 六、课程班级管理接口

### 6.1 基础 CRUD 接口

| 接口 | 方法 | 路径 | 权限 |
| ---- | ---- | ---- | ---- |
| 获取列表 | GET | /api/v1/course-classes | 所有登录用户 |
| 创建班级 | POST | /api/v1/course-classes | 超级管理员 |
| 获取详情 | GET | /api/v1/course-classes/:id | 所有登录用户 |
| 更新班级 | PUT | /api/v1/course-classes/:id | 超级管理员、教师 |
| 删除班级 | DELETE | /api/v1/course-classes/:id | 超级管理员 |

---

### 6.2 批量删除课程班级 ⭐

**接口路径：** `DELETE /api/v1/course-classes/batch`
**权限：** 超级管理员
**限制：** 最多 50 个 ID

---

### 6.3 学生与课程班级关系接口

| 接口 | 方法 | 路径 | 说明 |
| ---- | ---- | ---- | ---- |
| 获取学生列表 | GET | /api/v1/course-classes/:id/students | 支持 status 筛选 |
| 添加学生 | POST | /api/v1/course-classes/:id/students | 单个添加 |
| 移除学生 | DELETE | /api/v1/course-classes/:id/students/:studentId | 单个移除 |

---

### 6.4 批量添加学生到课程班级 ⭐

**接口路径：** `POST /api/v1/course-classes/:id/students/batch`
**权限：** 超级管理员、教师
**限制：** 最多 100 个学生 ID

**请求示例：**
```json
{ "studentIds": [1, 2, 3, 4, 5] }
```

**错误响应示例：**
```json
{
  "code": 200,
  "message": "批量添加部分完成",
  "data": {
    "success": 3,
    "failed": 2,
    "results": [
      { "studentId": 1, "status": "success" },
      { "studentId": 2, "status": "failed", "error": { "code": 30001, "message": "学生已在该班级中" } },
      { "studentId": 3, "status": "failed", "error": { "code": 20001, "message": "班级人数已满" } }
    ]
  }
}
```

---

### 6.5 批量移除学生从课程班级 ⭐

**接口路径：** `DELETE /api/v1/course-classes/:id/students/batch`
**权限：** 超级管理员、教师
**限制：** 最多 100 个学生 ID

---

## 七、学生个人接口

### 7.1 获取我的专业班级

**接口路径：** `GET /api/v1/student/my-major-class`
**权限：** 学生

**成功响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "id": 1,
    "name": "计算机科学与技术2024级1班",
    "code": "CS2024-01",
    "counselorName": "李老师",
    "status": "approved",
    "joinedAt": "2024-01-01 10:00:00"
  }
}
```

**错误响应：**
```json
{ "code": 30003, "message": "学生未分配专业班级", "data": null }
```

---

### 7.2 获取我的课程班级列表

**接口路径：** `GET /api/v1/student/my-course-classes`
**权限：** 学生

**成功响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    { "id": 1, "name": "数据结构与算法", "code": "CS101-2024", "teacherName": "王老师", "status": "approved", "joinedAt": "2024-01-01 10:00:00" }
  ]
}
```

---

## 八、教师专属接口

### 8.1 获取我的课程班级列表

**接口路径：** `GET /api/v1/teacher/my-course-classes`
**权限：** 教师

**成功响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    { "id": 1, "name": "数据结构与算法", "code": "CS101-2024", "studentCount": 45, "pendingCount": 3, "createdAt": "2024-01-01 10:00:00" }
  ]
}
```

---

## 九、辅导员专属接口

### 9.1 获取我负责的专业班级列表

**接口路径：** `GET /api/v1/counselor/my-major-classes`
**权限：** 辅导员

**成功响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": [
    { "id": 1, "name": "计算机科学与技术2024级1班", "code": "CS2024-01", "studentCount": 30, "pendingCount": 2, "createdAt": "2024-01-01 10:00:00" }
  ]
}
```

---

## 十、批量接口汇总 ⭐

为减轻前端请求压力，系统提供以下批量操作接口：

| 模块 | 接口 | 方法 | 路径 | 限制 |
| ---- | ---- | ---- | ---- | ---- |
| 用户 | 批量创建 | POST | /api/v1/users/batch | 100条 |
| 用户 | 批量获取 | POST | /api/v1/users/batch-get | 100个ID |
| 用户 | 批量删除 | DELETE | /api/v1/users/batch | 100个ID |
| 专业班级 | 批量删除 | DELETE | /api/v1/major-classes/batch | 50个ID |
| 专业班级 | 批量添加学生 | POST | /api/v1/major-classes/:id/students/batch | 100个ID |
| 专业班级 | 批量移除学生 | DELETE | /api/v1/major-classes/:id/students/batch | 100个ID |
| 课程班级 | 批量删除 | DELETE | /api/v1/course-classes/batch | 50个ID |
| 课程班级 | 批量添加学生 | POST | /api/v1/course-classes/:id/students/batch | 100个ID |
| 课程班级 | 批量移除学生 | DELETE | /api/v1/course-classes/:id/students/batch | 100个ID |

**批量接口通用响应格式：**

```json
{
  "code": 200,
  "message": "批量操作完成",
  "data": {
    "success": 8,
    "failed": 2,
    "results": [
      { "id": 1, "status": "success" },
      { "id": 2, "status": "failed", "error": { "code": 10001, "message": "错误原因" } }
    ]
  }
}
```

---

## 十一、接口权限汇总

| 接口 | 学生 | 教师 | 辅导员 | 管理员 |
| ---- | ---- | ---- | ------ | ------ |
| 登录/注册/密码重置 | ✓ | ✓ | ✓ | ✓ |
| 查看个人信息 | ✓ | ✓ | ✓ | ✓ |
| 修改个人信息 | ✓ | ✓ | ✓ | ✓ |
| 用户管理（CRUD） | ✗ | ✗ | 部分 | ✓ |
| 用户批量操作 | ✗ | ✗ | 部分 | ✓ |
| 专业班级管理（CRUD） | ✗ | ✗ | 部分 | ✓ |
| 课程班级管理（CRUD） | ✗ | 部分 | ✗ | ✓ |
| 加入/退出专业班级 | ✓ | ✗ | ✓ | ✓ |
| 加入/退出课程班级 | ✓ | ✓ | ✗ | ✓ |
| 批量管理班级学生 | ✗ | ✓ | ✓ | ✓ |
| 查询专业班级学生 | ✗ | ✗ | ✓ | ✓ |
| 查询课程班级学生 | ✗ | ✓ | ✗ | ✓ |

---

## 十二、总结

本接口文档定义了学生管理系统的全部 API 接口，涵盖认证、用户管理、专业班级管理、课程班级管理等核心功能模块。

**本次更新要点：**
1. 新增批量操作接口，支持数组 ID 参数，减轻前端请求压力
2. 所有接口增加错误码响应示例
3. 关联表接口支持 status 状态筛选（预留审核机制）
4. 统一批量接口响应格式

开发过程中应严格按照本文档进行接口实现与调用。