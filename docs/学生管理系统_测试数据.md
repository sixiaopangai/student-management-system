# 测试数据说明

## 一、测试账号

### 统一密码
**所有测试账号的初始密码均为：`123456`**

### 1.1 管理员账号

| 用户名 | 密码 | 姓名 | 状态 |
|--------|------|------|------|
| admin | 123456 | 系统管理员 | 正常 |

### 1.2 教师账号

| 用户名 | 密码 | 姓名 | 工号 | 状态 | 负责课程 |
|--------|------|------|------|------|----------|
| T202401 | 123456 | 王建国 | T202401 | 正常 | 数据结构与算法、机器学习基础 |
| T202402 | 123456 | 李明华 | T202402 | 正常 | 操作系统原理、Python程序设计 |
| T202403 | 123456 | 张秀英 | T202403 | **禁用** | 无 |
| T202404 | 123456 | 刘德华 | T202404 | 正常 | 计算机网络、Web开发技术 |
| T202405 | 123456 | 陈志强 | T202405 | 正常 | 数据库系统、软件工程导论 |

### 1.3 辅导员账号

| 用户名 | 密码 | 姓名 | 工号 | 状态 | 负责班级 |
|--------|------|------|------|------|----------|
| C202401 | 123456 | 张晓红 | C202401 | 正常 | 计科2023级1班、软工2023级1班 |
| C202402 | 123456 | 王丽娟 | C202402 | 正常 | 人工智能2023级1班、数据科学2023级1班 |
| C202403 | 123456 | 李国强 | C202403 | **禁用** | 计科2024级1班、网络工程2023级1班 |

### 1.4 学生账号

| 用户名 | 密码 | 姓名 | 学号 | 状态 | 专业班级 |
|--------|------|------|------|------|----------|
| 23010001 | 123456 | 张三 | 23010001 | 正常 | 计科2023级1班 |
| 23010002 | 123456 | 李四 | 23010002 | 正常 | 计科2023级1班 |
| 23020001 | 123456 | 陈小明 | 23020001 | 正常 | 软工2023级1班 |
| 23020002 | 123456 | 林小红 | 23020002 | 正常 | 软工2023级1班 |
| 23030001 | 123456 | 高志远 | 23030001 | 正常 | 人工智能2023级1班 |
| 23030002 | 123456 | 罗思琪 | 23030002 | **禁用** | 人工智能2023级1班 |
| 23040001 | 123456 | 邓子豪 | 23040001 | 正常 | 数据科学2023级1班 |
| 23040002 | 123456 | 萧雨晴 | 23040002 | 正常 | 数据科学2023级1班 |

---

## 二、专业班级数据

| ID | 班级名称 | 班级代码 | 辅导员 | 已通过 | 待审批 |
|----|----------|----------|--------|--------|--------|
| 1 | 计算机科学与技术2023级1班 | CS-2023-01 | 张晓红(C202401) | 8人 | 2人 |
| 2 | 软件工程2023级1班 | SE-2023-01 | 张晓红(C202401) | 8人 | 2人 |
| 3 | 人工智能2023级1班 | AI-2023-01 | 王丽娟(C202402) | 6人 | 2人 |
| 4 | 数据科学2023级1班 | DS-2023-01 | 王丽娟(C202402) | 6人 | 2人 |
| 5 | 计算机科学与技术2024级1班 | CS-2024-01 | 李国强(C202403) | 4人 | 2人 |
| 6 | 网络工程2023级1班 | NE-2023-01 | 李国强(C202403) | 0人 | 0人 |

---

## 三、课程班级数据

| ID | 课程名称 | 课程代码 | 授课教师 | 人数上限 | 已通过 | 待审批 |
|----|----------|----------|----------|----------|--------|--------|
| 1 | 数据结构与算法 | DS-2024-01 | 王建国(T202401) | 60 | 10人 | 3人 |
| 2 | 操作系统原理 | OS-2024-01 | 李明华(T202402) | 50 | 6人 | 2人 |
| 3 | 计算机网络 | CN-2024-01 | 刘德华(T202404) | 55 | 5人 | 2人 |
| 4 | 数据库系统 | DB-2024-01 | 陈志强(T202405) | 50 | 8人 | 3人 |
| 5 | 软件工程导论 | SE-2024-01 | 陈志强(T202405) | 45 | 7人 | 2人 |
| 6 | 机器学习基础 | ML-2024-01 | 王建国(T202401) | 40 | 8人 | 4人 |
| 7 | Python程序设计 | PY-2024-01 | 李明华(T202402) | 80 | 15人 | 5人 |
| 8 | Web开发技术 | WEB-2024-01 | 刘德华(T202404) | 50 | 6人 | 3人 |

---

## 四、状态说明

### 4.1 用户状态

系统中用户状态只有两种：

| 状态 | 说明 | 效果 |
|------|------|------|
| **active (正常)** | 账号正常可用 | 可以正常登录和使用系统 |
| **inactive (禁用)** | 账号被管理员禁用 | 无法登录，提示"账号已被禁用" |

**禁用账号（用于测试登录失败）：**
- T202403 (张秀英) - 教师
- C202403 (李国强) - 辅导员
- 23030002 (罗思琪) - 学生

### 4.2 班级关联状态

学生与班级的关联状态只有两种：

| 状态 | 说明 | 操作 |
|------|------|------|
| **pending (待审批)** | 学生申请加入，等待审批 | 可以通过或拒绝 |
| **approved (已通过)** | 审批通过，正式成员 | 可以移除 |

**业务逻辑：**
- 学生申请加入班级 → 状态为 `pending`
- 审批通过 → 状态变为 `approved`
- 审批拒绝 → 直接删除记录
- 移除学生 → 直接删除记录

---

## 五、测试场景覆盖

### 5.1 登录功能测试
- ✅ 管理员登录 (admin / 123456)
- ✅ 教师登录 (T202401 / 123456)
- ✅ 辅导员登录 (C202401 / 123456)
- ✅ 学生登录 (23010001 / 123456)
- ✅ 禁用账号登录失败 (T202403, C202403, 23030002)
- ✅ 错误密码登录失败
- ✅ 不存在用户登录失败
- ✅ 记住我功能

### 5.2 用户管理测试
- ✅ 管理员创建用户
- ✅ 管理员编辑用户信息
- ✅ 管理员禁用/启用用户
- ✅ 管理员删除用户
- ✅ 批量操作用户
- ✅ 按条件查询用户

### 5.3 专业班级管理测试
- ✅ 管理员创建专业班级
- ✅ 管理员删除专业班级
- ✅ 辅导员查看自己管理的班级
- ✅ 辅导员管理班级学生
- ✅ 学生加入专业班级
- ✅ 学生退出专业班级
- ✅ **辅导员审批学生申请（通过/拒绝）**
- ✅ **辅导员批量审批学生**
- ✅ 查询班级学生列表（按状态筛选）
- ✅ 分配辅导员到班级
- ✅ **按辅导员姓名搜索班级**

### 5.4 课程班级管理测试
- ✅ 管理员创建课程班级
- ✅ 管理员删除课程班级
- ✅ 教师查看自己的课程
- ✅ 教师管理课程学生
- ✅ 学生加入课程班级
- ✅ 学生退出课程班级
- ✅ **教师审批学生申请（通过/拒绝）**
- ✅ **教师批量审批学生**
- ✅ 查询课程学生列表（按状态筛选）
- ✅ 分配教师到课程
- ✅ 课程人数限制测试
- ✅ **按教师姓名搜索课程**

### 5.5 审批功能测试 ⭐

#### 5.5.1 辅导员审批专业班级学生

| 测试账号 | 操作 | 预期结果 |
|----------|------|----------|
| C202401 (张晓红) | 查看待审批学生 | 显示计科2023级1班和软工2023级1班的待审批学生 |
| C202401 | 审批通过学生 | 学生状态变为 approved |
| C202401 | 审批拒绝学生 | 学生关联记录被删除 |
| C202401 | 批量审批 | 多个学生同时通过 |
| C202402 (王丽娟) | 查看待审批学生 | 显示人工智能和数据科学班级的待审批学生 |

#### 5.5.2 教师审批课程班级学生

| 测试账号 | 操作 | 预期结果 |
|----------|------|----------|
| T202401 (王建国) | 查看待审批学生 | 显示数据结构和机器学习课程的待审批学生 |
| T202401 | 审批通过学生 | 学生状态变为 approved |
| T202401 | 审批拒绝学生 | 学生关联记录被删除 |
| T202402 (李明华) | 查看待审批学生 | 显示操作系统和Python课程的待审批学生 |

### 5.6 搜索功能测试 ⭐

#### 5.6.1 课程班级搜索
搜索框支持按**课程名称、课程编码、教师姓名**进行模糊搜索。

| 搜索关键词 | 预期结果 |
|------------|----------|
| `王建国` | 数据结构与算法、机器学习基础（王建国教授的课程） |
| `李明华` | 操作系统原理、Python程序设计（李明华教授的课程） |
| `刘德华` | 计算机网络、Web开发技术（刘德华教授的课程） |
| `陈志强` | 数据库系统、软件工程导论（陈志强教授的课程） |
| `数据` | 数据结构与算法、数据库系统 |
| `DS` | 数据结构与算法(DS-2024-01)、数据科学相关 |
| `Python` | Python程序设计 |

#### 5.6.2 专业班级搜索
搜索框支持按**班级名称、班级编码、辅导员姓名**进行模糊搜索。

| 搜索关键词 | 预期结果 |
|------------|----------|
| `张晓红` | 计算机科学与技术2023级1班、软件工程2023级1班（张晓红负责的班级） |
| `王丽娟` | 人工智能2023级1班、数据科学2023级1班（王丽娟负责的班级） |
| `李国强` | 计算机科学与技术2024级1班、网络工程2023级1班（李国强负责的班级） |
| `计算机` | 计算机科学与技术2023级1班、计算机科学与技术2024级1班 |
| `2023` | 所有2023级班级 |
| `CS` | 计算机科学与技术相关班级(CS-2023-01, CS-2024-01) |

### 5.7 辅导员功能测试 ⭐

| 测试账号 | 功能 | 预期结果 |
|----------|------|----------|
| C202401 | 查看我的班级 | 显示2个班级（计科、软工） |
| C202401 | 查看班级学生 | 显示学生列表，可按状态筛选 |
| C202401 | 创建学生账号 | 成功创建学生，可选择加入班级 |
| C202401 | 批量创建学生 | 成功批量创建学生 |
| C202401 | 查看所有学生 | 显示所有负责班级的学生 |

### 5.8 查询与统计测试
- ✅ 管理员查询所有用户
- ✅ 按角色筛选用户
- ✅ 按状态筛选用户
- ✅ 按关键字搜索用户
- ✅ 辅导员查询班级学生
- ✅ 教师查询课程学生
- ✅ 学生查询自己的班级和课程

### 5.9 密码管理测试
- ✅ 用户修改密码
- ✅ 管理员重置用户密码
- ✅ 忘记密码流程
- ✅ 密码强度验证
- ✅ 旧密码验证

### 5.10 批量操作测试
- ✅ 批量禁用用户
- ✅ 批量启用用户
- ✅ 批量删除用户
- ✅ 批量添加学生到班级
- ✅ 批量移除学生
- ✅ 批量审批学生申请

---

## 六、使用方法

### 6.1 数据库环境说明

项目使用两个独立的数据库：

| 环境 | 数据库名称 | 配置文件 | 用途 |
|------|------------|----------|------|
| 开发环境 | student_management | .env | 日常开发和手动测试 |
| 测试环境 | student_management_test | .env.test | 自动化测试（集成测试） |

### 6.2 初始化开发数据库

```bash
# 方式1：使用 MySQL 命令行
mysql -u root -p < backend/database/init.sql

# 方式2：使用 npm 脚本
cd backend
npm run init-db
```

### 6.3 初始化测试数据库

```bash
cd backend

# 首次初始化测试数据库
npm run init-test-db

# 重置测试数据库（删除后重新创建）
npm run init-test-db:reset

# 清理测试数据库（仅删除）
npm run init-test-db:clean
```

### 6.4 运行测试

```bash
# 运行所有测试
npm test

# 运行集成测试（自动重置测试数据库）
npm run test:integration

# 运行单个测试文件
npx jest __tests__/integration/auth.integration.test.js --verbose
```

### 6.5 快速登录测试

```bash
# 测试管理员登录
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'

# 测试学生登录
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"23010001","password":"123456"}'

# 测试禁用账号登录（应该失败）
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"T202403","password":"123456"}'
```

### 6.6 搜索功能测试

```bash
# 按教师姓名搜索课程班级
curl -X GET "http://localhost:3000/api/v1/course-classes?keyword=王建国" \
  -H "Authorization: Bearer <token>"

# 按辅导员姓名搜索专业班级
curl -X GET "http://localhost:3000/api/v1/major-classes?keyword=张晓红" \
  -H "Authorization: Bearer <token>"

# 按课程名称搜索
curl -X GET "http://localhost:3000/api/v1/course-classes?keyword=数据结构" \
  -H "Authorization: Bearer <token>"

# 按班级编码搜索
curl -X GET "http://localhost:3000/api/v1/major-classes?keyword=CS-2023" \
  -H "Authorization: Bearer <token>"
```

### 6.7 审批功能测试

```bash
# 辅导员获取待审批学生
curl -X GET "http://localhost:3000/api/v1/counselor/my-major-classes/1/students?status=pending" \
  -H "Authorization: Bearer <counselor_token>"

# 辅导员审批通过
curl -X PUT "http://localhost:3000/api/v1/counselor/my-major-classes/1/students/18/approve" \
  -H "Authorization: Bearer <counselor_token>"

# 辅导员审批拒绝
curl -X PUT "http://localhost:3000/api/v1/counselor/my-major-classes/1/students/19/reject" \
  -H "Authorization: Bearer <counselor_token>" \
  -H "Content-Type: application/json" \
  -d '{"reason":"不符合条件"}'

# 教师获取待审批学生
curl -X GET "http://localhost:3000/api/v1/course-classes/1/students?status=pending" \
  -H "Authorization: Bearer <teacher_token>"

# 教师审批通过
curl -X PUT "http://localhost:3000/api/v1/course-classes/1/students/46/approve" \
  -H "Authorization: Bearer <teacher_token>"
```

---

## 七、注意事项

1. **密码统一**：所有测试账号的初始密码都是 `123456`
2. **禁用账号**：T202403、C202403、23030002 为禁用状态，用于测试禁用账号登录失败
3. **状态简化**：
   - 用户状态只有 active（正常）和 inactive（禁用）
   - 班级关联状态只有 pending（待审批）和 approved（已通过）
4. **数据关联**：学生已关联到对应的专业班级和课程班级
5. **辅导员分配**：每个专业班级都有对应的辅导员
6. **教师分配**：每个课程班级都有对应的授课教师
7. **待审批数据**：每个班级都有待审批的学生，用于测试审批功能
8. **搜索功能**：
   - 课程班级搜索支持：课程名称、课程编码、**教师姓名**
   - 专业班级搜索支持：班级名称、班级编码、**辅导员姓名**
9. **测试数据库隔离**：
   - 开发环境使用 `student_management` 数据库
   - 测试环境使用 `student_management_test` 数据库
   - 运行集成测试不会影响开发数据

---

## 八、修改记录

| 日期 | 修改内容 |
|------|----------|
| 2026-01-01 | 创建测试数据文档 |
| 2026-01-01 | 新增搜索功能测试说明，支持按教师/辅导员姓名搜索班级 |
| 2026-01-01 | 新增审批功能测试说明，包含辅导员和教师审批测试用例 |
| 2026-01-01 | 更新班级数据，添加待审批人数统计 |
| 2026-01-02 | 新增测试数据库环境说明，区分开发和测试数据库 |