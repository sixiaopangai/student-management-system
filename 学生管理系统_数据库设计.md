# 学生管理系统 — 数据库设计

## 一、文档说明

本文档用于说明学生管理系统的数据库设计方案，包括数据库选型、表结构设计、字段说明及关系模型，为系统开发提供数据层面的设计依据。

---

## 二、数据库选型

### 2.1 数据库类型

- **数据库：** MySQL 8.x
- **字符集：** utf8mb4
- **排序规则：** utf8mb4_general_ci

### 2.2 选型理由

- 成熟稳定，广泛应用于 Web 系统
- 支持复杂关系建模与事务处理
- 社区活跃，文档丰富
- 易于管理与可视化操作

---

## 三、数据库命名规范

### 3.1 表命名规范

- 使用小写字母
- 单词之间使用下划线分隔
- 表名使用单数形式
- 示例：`user`、`major_class`、`course_class`

### 3.2 字段命名规范

- 使用小写字母
- 单词之间使用下划线分隔
- 主键统一命名为 `id`
- 外键命名格式：`关联表名_id`
- 时间字段：`created_at`、`updated_at`

### 3.3 索引命名规范

- 主键索引：`pk_表名`
- 唯一索引：`uk_表名_字段名`
- 普通索引：`idx_表名_字段名`

---

## 四、数据表设计

### 4.1 用户表（user）

**表说明：** 存储系统所有用户信息，包括学生、教师、辅导员、管理员

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| username | VARCHAR(50) | NOT NULL | - | 用户名（唯一） |
| password | VARCHAR(255) | NOT NULL | - | 密码（加密存储） |
| real_name | VARCHAR(50) | NOT NULL | - | 真实姓名 |
| role | ENUM | NOT NULL | 'student' | 角色（student/teacher/counselor/admin） |
| email | VARCHAR(100) | NULL | NULL | 邮箱 |
| phone | VARCHAR(20) | NULL | NULL | 手机号 |
| avatar | VARCHAR(255) | NULL | NULL | 头像 URL |
| status | ENUM | NOT NULL | 'active' | 状态（active/inactive/locked） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：**

- 主键索引：`pk_user (id)`
- 唯一索引：`uk_user_username (username)`
- 唯一索引：`uk_user_email (email)`
- 普通索引：`idx_user_role (role)`

**建表语句：**

```sql
CREATE TABLE `user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `username` VARCHAR(50) NOT NULL COMMENT '用户名',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（加密）',
  `real_name` VARCHAR(50) NOT NULL COMMENT '真实姓名',
  `role` ENUM('student', 'teacher', 'counselor', 'admin') NOT NULL DEFAULT 'student' COMMENT '角色',
  `email` VARCHAR(100) DEFAULT NULL COMMENT '邮箱',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT '手机号',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `status` ENUM('active', 'inactive', 'locked') NOT NULL DEFAULT 'active' COMMENT '状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_username` (`username`),
  UNIQUE KEY `uk_user_email` (`email`),
  KEY `idx_user_role` (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='用户表';
```

---

### 4.2 专业班级表（major_class）

**表说明：** 存储专业班级信息

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| name | VARCHAR(100) | NOT NULL | - | 班级名称 |
| code | VARCHAR(50) | NOT NULL | - | 班级编码（唯一） |
| counselor_id | BIGINT | NULL | NULL | 辅导员 ID |
| description | TEXT | NULL | NULL | 班级描述 |
| status | ENUM | NOT NULL | 'active' | 状态（active/inactive） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：**

- 主键索引：`pk_major_class (id)`
- 唯一索引：`uk_major_class_code (code)`
- 外键索引：`idx_major_class_counselor (counselor_id)`

**建表语句：**

```sql
CREATE TABLE `major_class` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` VARCHAR(100) NOT NULL COMMENT '班级名称',
  `code` VARCHAR(50) NOT NULL COMMENT '班级编码',
  `counselor_id` BIGINT DEFAULT NULL COMMENT '辅导员ID',
  `description` TEXT DEFAULT NULL COMMENT '班级描述',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT '状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_major_class_code` (`code`),
  KEY `idx_major_class_counselor` (`counselor_id`),
  CONSTRAINT `fk_major_class_counselor` FOREIGN KEY (`counselor_id`) REFERENCES `user` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='专业班级表';
```

---

### 4.3 课程班级表（course_class）

**表说明：** 存储课程班级信息

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| name | VARCHAR(100) | NOT NULL | - | 课程名称 |
| code | VARCHAR(50) | NOT NULL | - | 课程编码（唯一） |
| teacher_id | BIGINT | NOT NULL | - | 授课教师 ID |
| description | TEXT | NULL | NULL | 课程描述 |
| max_students | INT | NULL | NULL | 最大学生数 |
| status | ENUM | NOT NULL | 'active' | 状态（active/inactive） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：**

- 主键索引：`pk_course_class (id)`
- 唯一索引：`uk_course_class_code (code)`
- 外键索引：`idx_course_class_teacher (teacher_id)`

**建表语句：**

```sql
CREATE TABLE `course_class` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` VARCHAR(100) NOT NULL COMMENT '课程名称',
  `code` VARCHAR(50) NOT NULL COMMENT '课程编码',
  `teacher_id` BIGINT NOT NULL COMMENT '授课教师ID',
  `description` TEXT DEFAULT NULL COMMENT '课程描述',
  `max_students` INT DEFAULT NULL COMMENT '最大学生数',
  `status` ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT '状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_course_class_code` (`code`),
  KEY `idx_course_class_teacher` (`teacher_id`),
  CONSTRAINT `fk_course_class_teacher` FOREIGN KEY (`teacher_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='课程班级表';
```

---

### 4.4 学生专业班级关联表（student_major_class）

**表说明：** 存储学生与专业班级的关联关系

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| student_id | BIGINT | NOT NULL | - | 学生 ID |
| major_class_id | BIGINT | NOT NULL | - | 专业班级 ID |
| status | ENUM | NOT NULL | 'approved' | 关联状态（pending/approved/rejected/removed） |
| joined_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 加入时间 |
| approved_at | DATETIME | NULL | NULL | 审核通过时间 |
| approved_by | BIGINT | NULL | NULL | 审核人 ID |
| remark | VARCHAR(255) | NULL | NULL | 备注信息 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**status 字段说明（预留审核机制）：**

| 状态值 | 说明 |
| ------ | ---- |
| pending | 待审核（学生申请加入，等待辅导员/管理员审核） |
| approved | 已通过（审核通过，正式成员） |
| rejected | 已拒绝（审核未通过） |
| removed | 已移除（曾经是成员，后被移除） |

**索引：**

- 主键索引：`pk_student_major_class (id)`
- 唯一索引：`uk_student_major (student_id, major_class_id)`
- 外键索引：`idx_smc_student (student_id)`
- 外键索引：`idx_smc_major_class (major_class_id)`
- 普通索引：`idx_smc_status (status)`

**建表语句：**

```sql
CREATE TABLE `student_major_class` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `student_id` BIGINT NOT NULL COMMENT '学生ID',
  `major_class_id` BIGINT NOT NULL COMMENT '专业班级ID',
  `status` ENUM('pending', 'approved', 'rejected', 'removed') NOT NULL DEFAULT 'approved' COMMENT '关联状态',
  `joined_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  `approved_at` DATETIME DEFAULT NULL COMMENT '审核通过时间',
  `approved_by` BIGINT DEFAULT NULL COMMENT '审核人ID',
  `remark` VARCHAR(255) DEFAULT NULL COMMENT '备注信息',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_student_major` (`student_id`, `major_class_id`),
  KEY `idx_smc_student` (`student_id`),
  KEY `idx_smc_major_class` (`major_class_id`),
  KEY `idx_smc_status` (`status`),
  CONSTRAINT `fk_smc_student` FOREIGN KEY (`student_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_smc_major_class` FOREIGN KEY (`major_class_id`) REFERENCES `major_class` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_smc_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `user` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='学生专业班级关联表';
```

---

### 4.5 学生课程班级关联表（student_course_class）

**表说明：** 存储学生与课程班级的关联关系

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| student_id | BIGINT | NOT NULL | - | 学生 ID |
| course_class_id | BIGINT | NOT NULL | - | 课程班级 ID |
| status | ENUM | NOT NULL | 'approved' | 关联状态（pending/approved/rejected/removed） |
| joined_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 加入时间 |
| approved_at | DATETIME | NULL | NULL | 审核通过时间 |
| approved_by | BIGINT | NULL | NULL | 审核人 ID |
| remark | VARCHAR(255) | NULL | NULL | 备注信息 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**status 字段说明（预留审核机制）：**

| 状态值 | 说明 |
| ------ | ---- |
| pending | 待审核（学生申请加入，等待教师/管理员审核） |
| approved | 已通过（审核通过，正式成员） |
| rejected | 已拒绝（审核未通过） |
| removed | 已移除（曾经是成员，后被移除） |

**索引：**

- 主键索引：`pk_student_course_class (id)`
- 唯一索引：`uk_student_course (student_id, course_class_id)`
- 外键索引：`idx_scc_student (student_id)`
- 外键索引：`idx_scc_course_class (course_class_id)`
- 普通索引：`idx_scc_status (status)`

**建表语句：**

```sql
CREATE TABLE `student_course_class` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `student_id` BIGINT NOT NULL COMMENT '学生ID',
  `course_class_id` BIGINT NOT NULL COMMENT '课程班级ID',
  `status` ENUM('pending', 'approved', 'rejected', 'removed') NOT NULL DEFAULT 'approved' COMMENT '关联状态',
  `joined_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  `approved_at` DATETIME DEFAULT NULL COMMENT '审核通过时间',
  `approved_by` BIGINT DEFAULT NULL COMMENT '审核人ID',
  `remark` VARCHAR(255) DEFAULT NULL COMMENT '备注信息',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_student_course` (`student_id`, `course_class_id`),
  KEY `idx_scc_student` (`student_id`),
  KEY `idx_scc_course_class` (`course_class_id`),
  KEY `idx_scc_status` (`status`),
  CONSTRAINT `fk_scc_student` FOREIGN KEY (`student_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_scc_course_class` FOREIGN KEY (`course_class_id`) REFERENCES `course_class` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_scc_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `user` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='学生课程班级关联表';
```

---

### 4.6 密码重置记录表（password_reset）

**表说明：** 存储密码重置验证码记录

| 字段名 | 数据类型 | 是否为空 | 默认值 | 说明 |
| ------ | -------- | -------- | ------ | ---- |
| id | BIGINT | NOT NULL | AUTO_INCREMENT | 主键 |
| user_id | BIGINT | NOT NULL | - | 用户 ID |
| email | VARCHAR(100) | NOT NULL | - | 邮箱 |
| code | VARCHAR(10) | NOT NULL | - | 验证码 |
| expired_at | DATETIME | NOT NULL | - | 过期时间 |
| used | TINYINT | NOT NULL | 0 | 是否已使用 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**

- 主键索引：`pk_password_reset (id)`
- 普通索引：`idx_pr_user (user_id)`
- 普通索引：`idx_pr_email_code (email, code)`

**建表语句：**

```sql
CREATE TABLE `password_reset` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `email` VARCHAR(100) NOT NULL COMMENT '邮箱',
  `code` VARCHAR(10) NOT NULL COMMENT '验证码',
  `expired_at` DATETIME NOT NULL COMMENT '过期时间',
  `used` TINYINT NOT NULL DEFAULT 0 COMMENT '是否已使用',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_pr_user` (`user_id`),
  KEY `idx_pr_email_code` (`email`, `code`),
  CONSTRAINT `fk_pr_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='密码重置记录表';
```

---

## 五、E-R 关系图

```
┌─────────────┐       ┌─────────────────────┐       ┌─────────────┐
│    user     │       │ student_major_class │       │ major_class │
│─────────────│       │─────────────────────│       │─────────────│
│ id (PK)     │◄──────│ student_id (FK)     │       │ id (PK)     │
│ username    │       │ major_class_id (FK) │──────►│ name        │
│ password    │       │ status              │       │ code        │
│ real_name   │       │ joined_at           │       │ counselor_id│──┐
│ role        │       │ approved_at         │       │ description │  │
│ email       │       │ approved_by (FK)    │──┐    └─────────────┘  │
│ phone       │       └─────────────────────┘  │                     │
│ status      │                                │    ┌─────────────┐  │
│ ...         │       ┌─────────────────────┐  │    │course_class │  │
└─────────────┘       │student_course_class │  │    │─────────────│  │
      ▲               │─────────────────────│  │    │ id (PK)     │  │
      │        ┌──────│ student_id (FK)     │  │    │ name        │  │
      │        │      │ course_class_id(FK) │──┼───►│ code        │  │
      │        │      │ status              │  │    │ teacher_id  │──┤
      │        │      │ joined_at           │  │    │ description │  │
      │        │      │ approved_at         │  │    │ max_students│  │
      │        │      │ approved_by (FK)    │──┘    └─────────────┘  │
      │        │      └─────────────────────┘                        │
      │        │                                                     │
      └────────┴─────────────────────────────────────────────────────┘
                (counselor_id, teacher_id, approved_by 均关联 user 表)
```

---

## 六、关系说明

### 6.1 用户与专业班级

- 一个学生可以属于一个专业班级（通过 student_major_class 关联）
- 一个专业班级可以有多个学生
- 一个辅导员可以负责多个专业班级
- 关系类型：多对多（学生-专业班级）、一对多（辅导员-专业班级）

### 6.2 用户与课程班级

- 一个学生可以加入多个课程班级（通过 student_course_class 关联）
- 一个课程班级可以有多个学生
- 一个教师可以负责多个课程班级
- 关系类型：多对多（学生-课程班级）、一对多（教师-课程班级）

### 6.3 关联表状态说明

关联表中的 `status` 字段为未来审核机制预留：

- **当前阶段：** 默认值为 `approved`，学生加入/退出班级时直接生效
- **未来扩展：** 可启用审核流程，学生申请时状态为 `pending`，需管理员审核后变为 `approved`

---

## 七、初始化数据

### 7.1 管理员账号

```sql
INSERT INTO `user` (`username`, `password`, `real_name`, `role`, `email`, `status`)
VALUES ('admin', '$2b$10$xxxxx', '系统管理员', 'admin', 'admin@example.com', 'active');
```

> 注：密码需使用 bcrypt 加密后存储，示例中 `$2b$10$xxxxx` 为加密后的密码占位符

### 7.2 测试数据

```sql
-- 插入测试教师
INSERT INTO `user` (`username`, `password`, `real_name`, `role`, `email`, `status`)
VALUES 
('teacher001', '$2b$10$xxxxx', '王老师', 'teacher', 'teacher001@example.com', 'active'),
('teacher002', '$2b$10$xxxxx', '李老师', 'teacher', 'teacher002@example.com', 'active');

-- 插入测试辅导员
INSERT INTO `user` (`username`, `password`, `real_name`, `role`, `email`, `status`)
VALUES 
('counselor001', '$2b$10$xxxxx', '张辅导员', 'counselor', 'counselor001@example.com', 'active');

-- 插入测试学生
INSERT INTO `user` (`username`, `password`, `real_name`, `role`, `email`, `status`)
VALUES 
('student001', '$2b$10$xxxxx', '张三', 'student', 'student001@example.com', 'active'),
('student002', '$2b$10$xxxxx', '李四', 'student', 'student002@example.com', 'active'),
('student003', '$2b$10$xxxxx', '王五', 'student', 'student003@example.com', 'active');

-- 插入测试专业班级
INSERT INTO `major_class` (`name`, `code`, `counselor_id`, `description`)
VALUES 
('计算机科学与技术2024级1班', 'CS2024-01', 4, '计算机学院2024级本科1班'),
('软件工程2024级1班', 'SE2024-01', 4, '软件学院2024级本科1班');

-- 插入测试课程班级
INSERT INTO `course_class` (`name`, `code`, `teacher_id`, `description`, `max_students`)
VALUES 
('数据结构与算法', 'CS101-2024', 2, '计算机专业核心课程', 50),
('操作系统原理', 'CS102-2024', 3, '计算机专业核心课程', 45);

-- 插入学生与专业班级关联（含状态字段）
INSERT INTO `student_major_class` (`student_id`, `major_class_id`, `status`)
VALUES (5, 1, 'approved'), (6, 1, 'approved'), (7, 2, 'approved');

-- 插入学生与课程班级关联（含状态字段）
INSERT INTO `student_course_class` (`student_id`, `course_class_id`, `status`)
VALUES (5, 1, 'approved'), (5, 2, 'approved'), (6, 1, 'approved'), (7, 1, 'approved');
```

---

## 八、数据库维护建议

### 8.1 备份策略

- 每日进行全量备份
- 保留最近 7 天的备份文件
- 重要操作前进行手动备份

### 8.2 性能优化

- 定期分析表结构，优化索引
- 对大表进行分区处理（如需要）
- 监控慢查询日志

### 8.3 安全建议

- 数据库账号权限最小化
- 禁止使用 root 账号连接应用
- 定期更换数据库密码

---

## 九、数据库迁移脚本

### 9.1 从旧版本升级（添加 status 字段）

如果已有旧版本数据库，可使用以下脚本进行升级：

```sql
-- 为 student_major_class 表添加新字段
ALTER TABLE `student_major_class`
ADD COLUMN `status` ENUM('pending', 'approved', 'rejected', 'removed') NOT NULL DEFAULT 'approved' COMMENT '关联状态' AFTER `major_class_id`,
ADD COLUMN `approved_at` DATETIME DEFAULT NULL COMMENT '审核通过时间' AFTER `joined_at`,
ADD COLUMN `approved_by` BIGINT DEFAULT NULL COMMENT '审核人ID' AFTER `approved_at`,
ADD COLUMN `remark` VARCHAR(255) DEFAULT NULL COMMENT '备注信息' AFTER `approved_by`,
ADD COLUMN `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间' AFTER `created_at`,
ADD KEY `idx_smc_status` (`status`),
ADD CONSTRAINT `fk_smc_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `user` (`id`) ON DELETE SET NULL;

-- 为 student_course_class 表添加新字段
ALTER TABLE `student_course_class`
ADD COLUMN `status` ENUM('pending', 'approved', 'rejected', 'removed') NOT NULL DEFAULT 'approved' COMMENT '关联状态' AFTER `course_class_id`,
ADD COLUMN `approved_at` DATETIME DEFAULT NULL COMMENT '审核通过时间' AFTER `joined_at`,
ADD COLUMN `approved_by` BIGINT DEFAULT NULL COMMENT '审核人ID' AFTER `approved_at`,
ADD COLUMN `remark` VARCHAR(255) DEFAULT NULL COMMENT '备注信息' AFTER `approved_by`,
ADD COLUMN `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间' AFTER `created_at`,
ADD KEY `idx_scc_status` (`status`),
ADD CONSTRAINT `fk_scc_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `user` (`id`) ON DELETE SET NULL;

-- 将现有记录的状态设置为已通过
UPDATE `student_major_class` SET `status` = 'approved', `approved_at` = `joined_at` WHERE `status` = 'approved';
UPDATE `student_course_class` SET `status` = 'approved', `approved_at` = `joined_at` WHERE `status` = 'approved';
```

---

## 十、总结

本数据库设计文档定义了学生管理系统的完整数据模型，包括 6 张核心数据表及其关联关系。设计遵循数据库规范化原则，同时考虑了实际业务需求与查询性能